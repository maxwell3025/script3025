#!/bin/bash

# This script runs clang-tidy on all .cpp and .hpp files in the project.
# It requires a compile_commands.json file generated by CMake.

# Check for compile_commands.json
if [ ! -f "build/compile_commands.json" ]; then
    echo "Error: build/compile_commands.json not found."
    echo "Please configure CMake to generate it by adding 'set(CMAKE_EXPORT_COMPILE_COMMANDS ON)' to your CMakeLists.txt and re-running CMake."
    exit 1
fi

# Find all .cpp and .hpp files, excluding the build directory, and run clang-tidy on them
find . \( -name '*.cpp' -o -name '*.hpp' \) -a -not -path './build/*' -print0 | xargs -0 -P $(nproc) -n 1 clang-tidy -p build

echo "Clang-tidy check complete."
